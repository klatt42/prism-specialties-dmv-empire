<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GHL Automation Triggers Test - Prism Specialties DMV</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 1000px;
            margin: 0 auto;
            padding: 20px;
            line-height: 1.6;
            background: #f5f7fa;
        }
        .test-section {
            background: white;
            padding: 25px;
            margin: 20px 0;
            border-radius: 12px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            border-left: 4px solid #1976D2;
        }
        .trigger-test {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 20px;
            margin: 20px 0;
        }
        .trigger-card {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 8px;
            border: 2px solid #e0e0e0;
            text-align: center;
            transition: all 0.3s ease;
        }
        .trigger-card:hover {
            border-color: #1976D2;
            transform: translateY(-3px);
            box-shadow: 0 6px 20px rgba(0,0,0,0.15);
        }
        .trigger-card h4 {
            margin: 0 0 10px 0;
            color: #1976D2;
        }
        .trigger-btn {
            background: #1976D2;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 6px;
            cursor: pointer;
            margin: 8px;
            font-weight: 500;
            transition: all 0.3s ease;
        }
        .trigger-btn:hover {
            background: #1565C0;
            transform: translateY(-1px);
        }
        .trigger-btn.emergency {
            background: #d32f2f;
        }
        .trigger-btn.emergency:hover {
            background: #b71c1c;
        }
        .trigger-btn.content {
            background: #4CAF50;
        }
        .trigger-btn.content:hover {
            background: #388E3C;
        }
        .trigger-btn.engagement {
            background: #FF9800;
        }
        .trigger-btn.engagement:hover {
            background: #F57C00;
        }
        .test-results {
            background: #263238;
            color: #E0E0E0;
            padding: 20px;
            margin: 20px 0;
            border-radius: 8px;
            font-family: 'Courier New', monospace;
            font-size: 14px;
            white-space: pre-wrap;
            max-height: 400px;
            overflow-y: auto;
        }
        .status-indicator {
            display: inline-block;
            width: 12px;
            height: 12px;
            border-radius: 50%;
            margin-right: 8px;
        }
        .status-active {
            background: #4CAF50;
            animation: pulse 2s infinite;
        }
        .status-pending {
            background: #FF9800;
        }
        .status-error {
            background: #F44336;
        }
        .control-panel {
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
            margin: 20px 0;
            justify-content: center;
        }
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }
        .stat-card {
            background: linear-gradient(135deg, #1976D2 0%, #1565C0 100%);
            color: white;
            padding: 20px;
            border-radius: 8px;
            text-align: center;
        }
        .stat-value {
            font-size: 2rem;
            font-weight: bold;
            margin: 10px 0;
        }
        @keyframes pulse {
            0% { opacity: 1; }
            50% { opacity: 0.6; }
            100% { opacity: 1; }
        }
        .automation-log {
            background: white;
            border: 1px solid #ddd;
            border-radius: 8px;
            max-height: 300px;
            overflow-y: auto;
            margin: 20px 0;
        }
        .log-entry {
            padding: 12px;
            border-bottom: 1px solid #f0f0f0;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .log-entry:last-child {
            border-bottom: none;
        }
        .log-time {
            font-size: 0.85rem;
            color: #666;
        }
    </style>
</head>
<body>
    <h1>ü§ñ GHL Automation Triggers - Test Environment</h1>
    <p>Test the comprehensive automation trigger system for Prism Specialties DMV restoration services</p>

    <!-- System Status -->
    <div class="test-section">
        <h2>üìä System Status</h2>
        <div class="stats-grid">
            <div class="stat-card">
                <h3>Automation System</h3>
                <div class="stat-value" id="automation-status">
                    <span class="status-indicator status-pending"></span>Loading...
                </div>
            </div>
            <div class="stat-card">
                <h3>Total Triggers</h3>
                <div class="stat-value" id="total-triggers">0</div>
            </div>
            <div class="stat-card">
                <h3>Emergency Triggers</h3>
                <div class="stat-value" id="emergency-triggers">0</div>
            </div>
            <div class="stat-card">
                <h3>Success Rate</h3>
                <div class="stat-value" id="success-rate">0%</div>
            </div>
        </div>
    </div>

    <!-- Lead Temperature Triggers -->
    <div class="test-section">
        <h2>üå°Ô∏è Lead Temperature Automation Triggers</h2>
        <p>Test automation sequences based on lead scoring and temperature</p>

        <div class="trigger-test">
            <div class="trigger-card">
                <h4>üö® Emergency Response</h4>
                <p>Immediate 15-minute response SLA</p>
                <button class="trigger-btn emergency" onclick="triggerEmergencySequence()">Trigger Emergency</button>
                <div style="margin-top: 10px; font-size: 0.9rem; color: #666;">
                    100+ points ‚Ä¢ Immediate alerts
                </div>
            </div>

            <div class="trigger-card">
                <h4>üî• Hot Lead Sequence</h4>
                <p>4-hour priority response</p>
                <button class="trigger-btn" onclick="triggerHotLeadSequence()">Trigger Hot Lead</button>
                <div style="margin-top: 10px; font-size: 0.9rem; color: #666;">
                    50-99 points ‚Ä¢ Priority call task
                </div>
            </div>

            <div class="trigger-card">
                <h4>‚ö° Warm Lead Nurture</h4>
                <p>24-hour educational sequence</p>
                <button class="trigger-btn" onclick="triggerWarmLeadSequence()">Trigger Warm Lead</button>
                <div style="margin-top: 10px; font-size: 0.9rem; color: #666;">
                    25-49 points ‚Ä¢ Email education
                </div>
            </div>

            <div class="trigger-card">
                <h4>‚ùÑÔ∏è Cold Lead Sequence</h4>
                <p>48-hour nurture campaign</p>
                <button class="trigger-btn" onclick="triggerColdLeadSequence()">Trigger Cold Lead</button>
                <div style="margin-top: 10px; font-size: 0.9rem; color: #666;">
                    0-24 points ‚Ä¢ General nurture
                </div>
            </div>
        </div>
    </div>

    <!-- Content-Specific Triggers -->
    <div class="test-section">
        <h2>üé® Content-Specific Automation Triggers</h2>
        <p>Test specialized automation sequences based on content engagement</p>

        <div class="trigger-test">
            <div class="trigger-card">
                <h4>üë∞ Wedding Dress Specialist</h4>
                <p>High emotional value content</p>
                <button class="trigger-btn content" onclick="triggerWeddingContentSequence()">Trigger Wedding</button>
                <div style="margin-top: 10px; font-size: 0.9rem; color: #666;">
                    Bridal specialist ‚Ä¢ Urgent consultation
                </div>
            </div>

            <div class="trigger-card">
                <h4>ü™ñ Military Uniform Specialist</h4>
                <p>Veteran and family services</p>
                <button class="trigger-btn content" onclick="triggerMilitaryContentSequence()">Trigger Military</button>
                <div style="margin-top: 10px; font-size: 0.9rem; color: #666;">
                    Military expert ‚Ä¢ Veteran discount
                </div>
            </div>

            <div class="trigger-card">
                <h4>üèõÔ∏è Institutional Authority</h4>
                <p>Museum and government quality</p>
                <button class="trigger-btn content" onclick="triggerAuthorityContentSequence()">Trigger Authority</button>
                <div style="margin-top: 10px; font-size: 0.9rem; color: #666;">
                    Museum quality ‚Ä¢ Credentials
                </div>
            </div>

            <div class="trigger-card">
                <h4>üéì Expert Consultation</h4>
                <p>15+ minute deep engagement</p>
                <button class="trigger-btn content" onclick="triggerExpertConsultationSequence()">Trigger Expert</button>
                <div style="margin-top: 10px; font-size: 0.9rem; color: #666;">
                    Senior restorer ‚Ä¢ VIP treatment
                </div>
            </div>
        </div>
    </div>

    <!-- Engagement-Based Triggers -->
    <div class="test-section">
        <h2>‚ö° Engagement-Based Automation Triggers</h2>
        <p>Test automation sequences based on user behavior and engagement patterns</p>

        <div class="trigger-test">
            <div class="trigger-card">
                <h4>üîÑ Return Visitor</h4>
                <p>Multiple visit conversion</p>
                <button class="trigger-btn engagement" onclick="triggerReturnVisitorSequence()">Trigger Return</button>
                <div style="margin-top: 10px; font-size: 0.9rem; color: #666;">
                    3+ visits ‚Ä¢ Special offer
                </div>
            </div>

            <div class="trigger-card">
                <h4>üìú Deep Scroll Engagement</h4>
                <p>90%+ content consumption</p>
                <button class="trigger-btn engagement" onclick="triggerDeepScrollSequence()">Trigger Deep Scroll</button>
                <div style="margin-top: 10px; font-size: 0.9rem; color: #666;">
                    High interest ‚Ä¢ Next steps
                </div>
            </div>

            <div class="trigger-card">
                <h4>‚è±Ô∏è Time Milestone</h4>
                <p>5 or 10 minute engagement</p>
                <button class="trigger-btn engagement" onclick="triggerTimeMilestone()">Trigger Milestone</button>
                <div style="margin-top: 10px; font-size: 0.9rem; color: #666;">
                    Extended time ‚Ä¢ Exclusive access
                </div>
            </div>

            <div class="trigger-card">
                <h4>üìû Phone Interaction</h4>
                <p>Phone call or contact interest</p>
                <button class="trigger-btn engagement" onclick="triggerPhoneInteraction()">Trigger Phone</button>
                <div style="margin-top: 10px; font-size: 0.9rem; color: #666;">
                    Contact intent ‚Ä¢ Hot lead sequence
                </div>
            </div>
        </div>
    </div>

    <!-- Testing Controls -->
    <div class="test-section">
        <h2>üîß Testing Controls</h2>
        <div class="control-panel">
            <button class="trigger-btn" onclick="checkAutomationStatus()">Check Status</button>
            <button class="trigger-btn" onclick="showAutomationHistory()">Show History</button>
            <button class="trigger-btn" onclick="clearAutomationData()">Clear Data</button>
            <button class="trigger-btn" onclick="simulateSessionProgression()">Simulate Session</button>
            <button class="trigger-btn" onclick="testAllSequences()">Test All Sequences</button>
        </div>
    </div>

    <!-- Live Automation Log -->
    <div class="test-section">
        <h2>üìã Live Automation Log</h2>
        <div id="automation-log" class="automation-log">
            <div class="log-entry">
                <span>System ready for automation testing...</span>
                <span class="log-time" id="system-start-time"></span>
            </div>
        </div>
    </div>

    <!-- Test Results -->
    <div id="test-results" class="test-results">
Test Results: Automation system loading...

Click trigger buttons above to test different automation sequences.
Each trigger will show in the log above and store data locally for testing.

üö® Emergency triggers simulate immediate response workflows
üî• Hot lead triggers test priority follow-up sequences
‚ö° Warm/Cold triggers test nurture campaign automation
üé® Content triggers test specialist assignment workflows
‚ö° Engagement triggers test behavior-based automation

All triggers are logged locally for development/testing purposes.
</div>

    <!-- Include GHL Scripts -->
    <script src="../integrations/ghl/config/ghl-config.js"></script>
    <script src="assets/js/ghl-blog-integration.js"></script>
    <!-- Automation will be loaded automatically by main integration -->

    <script>
        // Test page specific functionality
        let testStartTime = Date.now();
        let triggerCount = 0;

        // Initialize test page
        document.addEventListener('DOMContentLoaded', function() {
            document.getElementById('system-start-time').textContent = new Date().toLocaleTimeString();

            // Check for automation system periodically
            const checkInterval = setInterval(() => {
                if (window.prismAutomation) {
                    updateSystemStatus('active');
                    clearInterval(checkInterval);
                } else {
                    updateSystemStatus('loading');
                }
            }, 1000);

            // Update stats every 5 seconds
            setInterval(updateStats, 5000);
        });

        // Lead Temperature Trigger Functions
        function triggerEmergencySequence() {
            if (window.prismAutomation) {
                window.prismAutomation.triggerEmergencySequence();
                logAutomation('Emergency Response Triggered', 'emergency');
            } else {
                logResult('‚ùå Automation system not loaded');
            }
        }

        function triggerHotLeadSequence() {
            const mockSession = createMockSession(75); // Hot lead score
            if (window.prismAutomation) {
                window.prismAutomation.triggerHotLeadSequence(mockSession);
                logAutomation('Hot Lead Sequence Triggered', 'hot');
            } else {
                logResult('‚ùå Automation system not loaded');
            }
        }

        function triggerWarmLeadSequence() {
            const mockSession = createMockSession(35); // Warm lead score
            if (window.prismAutomation) {
                window.prismAutomation.triggerWarmLeadSequence(mockSession);
                logAutomation('Warm Lead Nurture Triggered', 'warm');
            } else {
                logResult('‚ùå Automation system not loaded');
            }
        }

        function triggerColdLeadSequence() {
            const mockSession = createMockSession(15); // Cold lead score
            if (window.prismAutomation) {
                window.prismAutomation.triggerColdLeadSequence(mockSession);
                logAutomation('Cold Lead Sequence Triggered', 'cold');
            } else {
                logResult('‚ùå Automation system not loaded');
            }
        }

        // Content-Specific Trigger Functions
        function triggerWeddingContentSequence() {
            if (window.prismAutomation) {
                window.prismAutomation.triggerWeddingContentSequence();
                logAutomation('Wedding Content Specialist Triggered', 'content');
            } else {
                logResult('‚ùå Automation system not loaded');
            }
        }

        function triggerMilitaryContentSequence() {
            if (window.prismAutomation) {
                window.prismAutomation.triggerMilitaryContentSequence();
                logAutomation('Military Content Specialist Triggered', 'content');
            } else {
                logResult('‚ùå Automation system not loaded');
            }
        }

        function triggerAuthorityContentSequence() {
            if (window.prismAutomation) {
                window.prismAutomation.triggerAuthorityContentSequence();
                logAutomation('Authority Content Specialist Triggered', 'content');
            } else {
                logResult('‚ùå Automation system not loaded');
            }
        }

        function triggerExpertConsultationSequence() {
            if (window.prismAutomation) {
                window.prismAutomation.triggerExpertConsultationSequence();
                logAutomation('Expert Consultation Triggered', 'expert');
            } else {
                logResult('‚ùå Automation system not loaded');
            }
        }

        // Engagement-Based Trigger Functions
        function triggerReturnVisitorSequence() {
            if (window.prismAutomation) {
                window.prismAutomation.triggerReturnVisitorSequence();
                logAutomation('Return Visitor Conversion Triggered', 'engagement');
            } else {
                logResult('‚ùå Automation system not loaded');
            }
        }

        function triggerDeepScrollSequence() {
            if (window.prismAutomation) {
                // Simulate deep scroll by setting flag and calling handler
                window.prismAutomation.deepScrollTriggered = false; // Reset flag
                window.prismAutomation.handleScrollEngagement({ target: window });
                logAutomation('Deep Scroll Engagement Triggered', 'engagement');
            } else {
                logResult('‚ùå Automation system not loaded');
            }
        }

        function triggerTimeMilestone() {
            if (window.prismAutomation) {
                window.prismAutomation.triggerEngagementMilestone('5_minute');
                logAutomation('5-Minute Milestone Triggered', 'milestone');
            } else {
                logResult('‚ùå Automation system not loaded');
            }
        }

        function triggerPhoneInteraction() {
            if (window.phoneTracker) {
                const mockElement = document.createElement('a');
                mockElement.href = 'tel:202-335-4240';
                mockElement.className = 'emergency-phone-cta';
                window.phoneTracker.triggerHotLeadSequence('202-335-4240', 'DC');
                logAutomation('Phone Interaction Hot Lead Triggered', 'phone');
            } else {
                logResult('‚ùå Phone tracker not loaded');
            }
        }

        // Utility Functions
        function createMockSession(score) {
            return {
                sessionId: 'test_' + Date.now(),
                region: 'DC',
                contentScore: score,
                score: score,
                leadQuality: score >= 100 ? 'emergency' : score >= 50 ? 'hot' : score >= 25 ? 'warm' : 'cold',
                temperature: score >= 100 ? 'emergency' : score >= 50 ? 'hot' : score >= 25 ? 'warm' : 'cold'
            };
        }

        function updateSystemStatus(status) {
            const indicator = document.querySelector('#automation-status .status-indicator');
            const text = document.querySelector('#automation-status');

            indicator.className = 'status-indicator';

            switch(status) {
                case 'active':
                    indicator.classList.add('status-active');
                    text.innerHTML = '<span class="status-indicator status-active"></span>Active';
                    break;
                case 'loading':
                    indicator.classList.add('status-pending');
                    text.innerHTML = '<span class="status-indicator status-pending"></span>Loading...';
                    break;
                case 'error':
                    indicator.classList.add('status-error');
                    text.innerHTML = '<span class="status-indicator status-error"></span>Error';
                    break;
            }
        }

        function updateStats() {
            const automationData = getAutomationHistory();
            const totalTriggers = automationData.length;
            const emergencyTriggers = automationData.filter(a =>
                a.type === 'emergency_response' || a.type === 'emergency'
            ).length;

            const successfulTriggers = automationData.filter(a =>
                localStorage.getItem(a.key.replace('automation_', 'automation_success_'))
            ).length;

            const successRate = totalTriggers > 0 ? Math.round((successfulTriggers / totalTriggers) * 100) : 0;

            document.getElementById('total-triggers').textContent = totalTriggers;
            document.getElementById('emergency-triggers').textContent = emergencyTriggers;
            document.getElementById('success-rate').textContent = successRate + '%';
        }

        function logAutomation(message, type) {
            triggerCount++;
            const logEntry = document.createElement('div');
            logEntry.className = 'log-entry';
            logEntry.innerHTML = `
                <span><strong>${type.toUpperCase()}:</strong> ${message}</span>
                <span class="log-time">${new Date().toLocaleTimeString()}</span>
            `;

            const log = document.getElementById('automation-log');
            log.insertBefore(logEntry, log.firstChild);

            // Keep only last 50 entries
            while (log.children.length > 50) {
                log.removeChild(log.lastChild);
            }

            logResult(`‚úÖ ${message} - Check localStorage for data`);
        }

        function checkAutomationStatus() {
            if (window.prismAutomation) {
                const status = {
                    automationActive: true,
                    configLoaded: typeof GHL_CONFIG !== 'undefined',
                    phoneTrackerActive: typeof window.phoneTracker !== 'undefined',
                    automationHistory: getAutomationHistory().length
                };
                logResult('Automation Status:\n' + JSON.stringify(status, null, 2));
            } else {
                logResult('‚ùå Automation system not active');
            }
        }

        function showAutomationHistory() {
            if (window.prismAutomation && window.prismAutomation.getAutomationHistory) {
                const history = window.prismAutomation.getAutomationHistory();
                logResult('Automation History (' + history.length + ' entries):\n' +
                         JSON.stringify(history.slice(0, 10), null, 2));
            } else {
                const history = getAutomationHistory();
                logResult('Local Automation History (' + history.length + ' entries):\n' +
                         JSON.stringify(history.slice(0, 10), null, 2));
            }
        }

        function getAutomationHistory() {
            const history = [];
            for (let i = 0; i < localStorage.length; i++) {
                const key = localStorage.key(i);
                if (key.startsWith('prism_automation_')) {
                    try {
                        const data = JSON.parse(localStorage.getItem(key));
                        history.push({ key, ...data });
                    } catch (e) {
                        console.warn('Invalid automation data:', key);
                    }
                }
            }
            return history.sort((a, b) => b.timestamp - a.timestamp);
        }

        function clearAutomationData() {
            const keys = [];
            for (let i = 0; i < localStorage.length; i++) {
                const key = localStorage.key(i);
                if (key.startsWith('prism_automation_') || key.startsWith('prism_triggered_')) {
                    keys.push(key);
                }
            }
            keys.forEach(key => localStorage.removeItem(key));

            // Clear log
            document.getElementById('automation-log').innerHTML = `
                <div class="log-entry">
                    <span>Automation data cleared - ready for new tests</span>
                    <span class="log-time">${new Date().toLocaleTimeString()}</span>
                </div>
            `;

            logResult(`üßπ Cleared ${keys.length} automation records`);
            updateStats();
        }

        function simulateSessionProgression() {
            const steps = [
                { action: 'Page View', score: 5 },
                { action: 'Scroll 50%', score: 8 },
                { action: 'Wedding Content View', score: 45 },
                { action: 'Phone Hover', score: 10 },
                { action: 'Emergency CTA Click', score: 50 }
            ];

            let currentScore = 0;
            steps.forEach((step, index) => {
                setTimeout(() => {
                    currentScore += step.score;
                    const session = createMockSession(currentScore);

                    logAutomation(`Session Step ${index + 1}: ${step.action} (+${step.score} = ${currentScore})`, 'simulation');

                    // Trigger appropriate automation based on score
                    if (window.prismAutomation) {
                        if (currentScore >= 100) {
                            window.prismAutomation.triggerEmergencySequence(session);
                        } else if (currentScore >= 50) {
                            window.prismAutomation.triggerHotLeadSequence(session);
                        } else if (currentScore >= 25) {
                            window.prismAutomation.triggerWarmLeadSequence(session);
                        }
                    }
                }, index * 2000); // 2 second delays
            });

            logResult('üé¨ Session progression simulation started (10 seconds)');
        }

        function testAllSequences() {
            const sequences = [
                'triggerColdLeadSequence',
                'triggerWarmLeadSequence',
                'triggerHotLeadSequence',
                'triggerWeddingContentSequence',
                'triggerMilitaryContentSequence',
                'triggerReturnVisitorSequence',
                'triggerTimeMilestone',
                'triggerEmergencySequence'
            ];

            sequences.forEach((funcName, index) => {
                setTimeout(() => {
                    window[funcName]();
                    logAutomation(`Batch Test ${index + 1}/8: ${funcName}`, 'batch');
                }, index * 1500); // 1.5 second intervals
            });

            logResult('üöÄ Testing all automation sequences (12 seconds)');
        }

        function logResult(message) {
            const timestamp = new Date().toLocaleTimeString();
            document.getElementById('test-results').textContent =
                `[${timestamp}] ${message}\n\n` + document.getElementById('test-results').textContent;
        }

        // Auto-update page title with trigger count
        setInterval(() => {
            if (triggerCount > 0) {
                document.title = `(${triggerCount}) GHL Automation Test - Prism DMV`;
            }
        }, 1000);
    </script>
</body>
</html>